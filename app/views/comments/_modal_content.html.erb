<%# locals: (post:, comments:, remaining:) %>
<div class="flex flex-col h-full"
     data-controller="infinite-scroll"
     data-infinite-scroll-post-id-value="<%= post.id %>"
     data-infinite-scroll-offset-value="<%= comments.size %>"
     data-infinite-scroll-has-more-value="<%= remaining > 0 %>">
  <!-- Comments List -->
  <div class="flex-1 overflow-y-auto p-4"
       id="modal_comments_container_<%= post.id %>"
       data-infinite-scroll-target="scrollContainer">
    <% if comments.any? %>
      <div class="space-y-4" data-infinite-scroll-target="list">
        <% comments.each do |comment| %>
          <%= render "comments/comment", comment: comment %>
        <% end %>
      </div>

      <!-- Sentinel for infinite scroll -->
      <div data-infinite-scroll-target="sentinel" class="py-4">
        <% if remaining > 0 %>
          <div class="flex justify-center">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-gray-500 text-center py-8"><%= t("comments.no_comments") %></p>
    <% end %>
  </div>

  <!-- Comment Form -->
  <% if logged_in? %>
    <div class="border-t border-gray-200 p-4 bg-white shrink-0">
      <%= render "comments/modal_form", post: post, comment: post.comments.build %>
    </div>
  <% else %>
    <div class="border-t border-gray-200 p-4 bg-gray-50 text-center shrink-0">
      <p class="text-gray-500 text-sm">
        <%= link_to t("comments.login_to_comment"), login_path, class: "text-blue-600 hover:underline" %>
      </p>
    </div>
  <% end %>
</div>
