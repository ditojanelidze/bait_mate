<div class="max-w-2xl mx-auto" data-controller="open-modal">
  <!-- Profile Header -->
  <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
    <div class="flex items-center">
      <!-- Avatar -->
      <div class="flex-shrink-0">
        <% if @user.avatar.attached? %>
          <%= image_tag @user.avatar.variant(resize_to_fill: [96, 96]),
              class: "w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg" %>
        <% else %>
          <div class="w-24 h-24 rounded-full bg-blue-500 flex items-center justify-center border-4 border-white shadow-lg">
            <span class="text-white text-3xl font-bold"><%= @user.first_name[0] %></span>
          </div>
        <% end %>
      </div>

      <!-- User Info -->
      <div class="ml-6 flex-1">
        <h1 class="text-2xl font-bold text-gray-800"><%= @user.full_name %></h1>

        <!-- Stats -->
        <div class="flex items-center space-x-6 mt-3">
          <div class="text-center">
            <span class="block text-xl font-bold text-gray-800"><%= @user.posts.count %></span>
            <span class="text-sm text-gray-500"><%= t("users.posts") %></span>
          </div>
          <button type="button"
              class="text-center hover:opacity-75"
              data-action="click->open-modal#open"
              data-open-modal-url-param="<%= followers_user_path(@user) %>"
              data-open-modal-target-param="followers-modal">
            <span class="block text-xl font-bold text-gray-800" id="followers_count_<%= @user.id %>"><%= @user.followers_count %></span>
            <span class="text-sm text-gray-500"><%= t("users.followers") %></span>
          </button>
          <button type="button"
              class="text-center hover:opacity-75"
              data-action="click->open-modal#open"
              data-open-modal-url-param="<%= following_user_path(@user) %>"
              data-open-modal-target-param="following-modal">
            <span class="block text-xl font-bold text-gray-800"><%= @user.following_count %></span>
            <span class="text-sm text-gray-500"><%= t("users.following") %></span>
          </button>
        </div>
      </div>
    </div>

    <!-- Follow Button -->
    <% if logged_in? && @user != current_user %>
      <div class="mt-4">
        <%= render "follows/button", user: @user %>
      </div>
    <% elsif logged_in? && @user == current_user %>
      <div class="mt-4">
        <%= link_to t("profile.edit_title"), edit_profile_path,
            class: "block w-full text-center bg-gray-100 text-gray-800 px-4 py-2 rounded-lg font-medium hover:bg-gray-200 transition-colors" %>
      </div>
    <% end %>
  </div>

  <!-- Posts Grid -->
  <% if @posts.any? %>
    <div class="grid grid-cols-2 gap-1">
      <% @posts.each do |post| %>
        <%= link_to post, class: "aspect-square overflow-hidden" do %>
          <% if post.image.attached? %>
            <%= image_tag post.image.variant(resize_to_fill: [400, 400]),
                class: "w-full h-full object-cover hover:opacity-90 transition-opacity" %>
          <% else %>
            <div class="w-full h-full bg-gray-200 flex items-center justify-center">
              <%= inline_svg_tag "svg/image.svg", class: "w-12 h-12 text-gray-400" %>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
  <% else %>
    <div class="bg-white rounded-2xl shadow-lg p-8 text-center">
      <%= inline_svg_tag "svg/empty-box.svg", class: "w-16 h-16 text-gray-300 mx-auto mb-4" %>
      <p class="text-gray-500"><%= t("users.no_posts") %></p>
    </div>
  <% end %>
</div>

<!-- Followers Modal -->
<%= render "components/modal", id: "followers-modal", title: t("users.followers") do %>
  <div id="followers-modal-content" class="overflow-y-auto">
    <!-- Content loaded via JavaScript -->
  </div>
<% end %>

<!-- Following Modal -->
<%= render "components/modal", id: "following-modal", title: t("users.following") do %>
  <div id="following-modal-content" class="overflow-y-auto">
    <!-- Content loaded via JavaScript -->
  </div>
<% end %>
